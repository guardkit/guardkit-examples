"""
{{FeatureName}} API Router

This module defines the API endpoints for {{FeatureName}} feature.
"""

from fastapi import APIRouter, Depends, HTTPException, status, Query
from sqlalchemy.ext.asyncio import AsyncSession
from typing import List

from src.db.session import get_db
from src.{{FeatureName}} import crud, schemas
from src.{{FeatureName}}.dependencies import valid_{{entity_name}}_id
from src.core.dependencies import get_current_active_user

router = APIRouter()


@router.get("/", response_model=List[schemas.{{EntityName}}Public])
async def list_{{entity_name_plural}}(
    db: AsyncSession = Depends(get_db),
    skip: int = Query(0, ge=0, description="Number of items to skip"),
    limit: int = Query(100, ge=1, le=1000, description="Maximum number of items to return"),
    current_user: schemas.User = Depends(get_current_active_user),
) -> List[schemas.{{EntityName}}Public]:
    """
    Retrieve list of {{entity_name_plural}} with pagination.

    - **skip**: Number of items to skip (for pagination)
    - **limit**: Maximum number of items to return (max 1000)
    """
    {{entity_name_plural}} = await crud.{{entity_name}}.get_multi(
        db, skip=skip, limit=limit
    )
    return {{entity_name_plural}}


@router.get("/{{{entity_name}}_id}", response_model=schemas.{{EntityName}}Public)
async def get_{{entity_name}}(
    {{entity_name}}: schemas.{{EntityName}}InDB = Depends(valid_{{entity_name}}_id),
) -> schemas.{{EntityName}}Public:
    """
    Get {{entity_name}} by ID.

    - **{{entity_name}}_id**: The ID of the {{entity_name}} to retrieve
    """
    return {{entity_name}}


@router.post("/", response_model=schemas.{{EntityName}}Public, status_code=status.HTTP_201_CREATED)
async def create_{{entity_name}}(
    {{entity_name}}_data: schemas.{{EntityName}}Create,
    db: AsyncSession = Depends(get_db),
    current_user: schemas.User = Depends(get_current_active_user),
) -> schemas.{{EntityName}}Public:
    """
    Create new {{entity_name}}.

    - **{{entity_name}}_data**: {{EntityName}} creation data
    """
    {{entity_name}} = await crud.{{entity_name}}.create(db, obj_in={{entity_name}}_data)
    return {{entity_name}}


@router.put("/{{{entity_name}}_id}", response_model=schemas.{{EntityName}}Public)
async def update_{{entity_name}}(
    update_data: schemas.{{EntityName}}Update,
    {{entity_name}}: schemas.{{EntityName}}InDB = Depends(valid_{{entity_name}}_id),
    db: AsyncSession = Depends(get_db),
    current_user: schemas.User = Depends(get_current_active_user),
) -> schemas.{{EntityName}}Public:
    """
    Update {{entity_name}} by ID.

    - **{{entity_name}}_id**: The ID of the {{entity_name}} to update
    - **update_data**: Fields to update
    """
    updated_{{entity_name}} = await crud.{{entity_name}}.update(
        db, db_obj={{entity_name}}, obj_in=update_data
    )
    return updated_{{entity_name}}


@router.delete("/{{{entity_name}}_id}", status_code=status.HTTP_204_NO_CONTENT)
async def delete_{{entity_name}}(
    {{entity_name}}: schemas.{{EntityName}}InDB = Depends(valid_{{entity_name}}_id),
    db: AsyncSession = Depends(get_db),
    current_user: schemas.User = Depends(get_current_active_user),
) -> None:
    """
    Delete {{entity_name}} by ID.

    - **{{entity_name}}_id**: The ID of the {{entity_name}} to delete
    """
    await crud.{{entity_name}}.delete(db, id={{entity_name}}.id)
